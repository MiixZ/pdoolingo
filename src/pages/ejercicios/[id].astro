---
import type { Ejercicio } from "@interfaces/Ejercicio";
import type { Respuesta } from "@interfaces/Respuesta";

import EjercicioLayout from "@layouts/EjercicioLayout.astro";
import { getEjercicio } from "@services/ejercicios";
import { getUsuarioID } from "@services/usuario";
import { getRespuestas } from "@services/ejercicios";

import Cuerpo from "@components/ejercicios/in/cuerpo";
import Header from "@components/ejercicios/in/header.astro";

const { id } = Astro.params;
const ejercicio: Ejercicio | null = await getEjercicio(Number(id));

if (!ejercicio) {
  Astro.response.status = 404;
  return;
}

const respuestas: Respuesta[] = await getRespuestas(Number(id));

const url = new URL(Astro.request.url);
const id_usuario = url.searchParams.get("id_usuario");
const usuario = await getUsuarioID(id_usuario);
---

<EjercicioLayout
  title="PDOOLingo - Ejercicio"
  ejercicio={ejercicio}
  usuario={usuario}
>
  <Header ejercicio={ejercicio} />
  <Cuerpo ejercicio={ejercicio} respuestas={respuestas} client:load></Cuerpo>
</EjercicioLayout>